<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  var generateTOC = function() {
    var toc = '<ol class="toc-list">';
    var sectionCount = 0;
    $('.remark-slide-content').each(function(index, slide) {
      var $slide = $(slide);
      
      // Skip the title slide and the TOC slide
      if ($slide.hasClass('title-slide') || $slide.find('h1').text().trim().toLowerCase() === 'table of contents') {
        return;
      }
      $slide.find('h1').each(function() {
        var $header = $(this);
        var headerText = $header.text().trim();
        sectionCount++;
        
        toc += '<li><a href="#' + (index + 1) + '">' + 
               romanize(sectionCount) + '. ' + headerText + '</a></li>';
      });
    });
    
    toc += '</ol>';
    $('.toc').html(toc);
  };
  
  var updateSlideNumbers = function() {
    var sectionCount = 0;
    var subsectionCount = 0;
    var currentSectionTitle = '';
    $('.remark-slide-content').each(function(index, slide) {
      var $slide = $(slide);
      
      // Skip the title slide and the TOC slide
      if ($slide.hasClass('title-slide') || $slide.find('h1').text().trim().toLowerCase() === 'table of contents') {
        return;
      }
      $slide.find('h1, h2').each(function() {
        var $header = $(this);
        var headerText = $header.text().trim();
        if ($header.is('h1')) {
          sectionCount++;
          subsectionCount = 0;
          currentSectionTitle = headerText;
          $header.html('<span class="section-number">' + romanize(sectionCount) + '. </span>' + headerText);
        } else if ($header.is('h2')) {
          subsectionCount++;
          if (!$header.prev().is('h1')) {
            $header.before('<h1 class="parent-section"><span class="section-number">' + romanize(sectionCount) + '. </span>' + currentSectionTitle + '</h1>');
          }
          $header.html('<span class="section-number">' + subsectionCount + '. </span>' + headerText);
        }
      });
    });
  };
  
  // Function to convert numbers to Roman numerals
  function romanize(num) {
    var lookup = {M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},roman = '',i;
    for (i in lookup) {
      while (num >= lookup[i]) {
        roman += i;
        num -= lookup[i];
      }
    }
    return roman;
  }
  
  // Wait for Remark to finish rendering
  var intervalId = setInterval(function() {
    if (document.querySelector('.remark-slide-content')) {
      clearInterval(intervalId);
      generateTOC();
      updateSlideNumbers();
    }
  }, 100);
});
</script>